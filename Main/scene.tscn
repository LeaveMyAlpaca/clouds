[gd_scene load_steps=27 format=4 uid="uid://bgnr33ubjk7rn"]

[ext_resource type="Script" uid="uid://dvng2yn1127pt" path="res://Main/RayTarget.cs" id="1_nxogm"]
[ext_resource type="Script" uid="uid://dsh2tjd3truas" path="res://Main/RayTracingHandler.cs" id="2_3253y"]
[ext_resource type="Script" uid="uid://7oi60kd7spx1" path="res://Main/free_look_camera.gd" id="2_m7jmp"]
[ext_resource type="RDShaderFile" uid="uid://b18jx5y0125bo" path="res://Main/RayTracer.glsl" id="3_u3cyc"]
[ext_resource type="Material" uid="uid://b0e57yv3p553u" path="res://Main/Output/OutputMaterial.tres" id="4_tqduk"]
[ext_resource type="ImageTexture3D" uid="uid://bg64wm06td4cy" path="res://Main/Noise/textures/composed noise inverted.tres" id="6_g02a5"]
[ext_resource type="Script" uid="uid://dx8lfvsf734l6" path="res://Main/Noise/ScalableVornoiNoiseGenerator.cs" id="7_tqduk"]
[ext_resource type="RDShaderFile" uid="uid://cegc6vjdepu15" path="res://Main/Noise/worleyNoiseGenerator.glsl" id="8_0sf6n"]
[ext_resource type="ImageTexture3D" uid="uid://b0nbcs38whmo4" path="res://worley test3.tres" id="9_g02a5"]
[ext_resource type="ImageTexture3D" uid="uid://b65vrxhlr7dos" path="res://Main/Noise/textures/Worley big cells.tres" id="9_p530x"]
[ext_resource type="Script" uid="uid://hqhmcim0y2oh" path="res://Main/Noise/TexturesComposer.cs" id="10_0gbod"]
[ext_resource type="Script" uid="uid://h50akikpf6si" path="res://Main/Noise/TextureSetting.cs" id="10_g02a5"]

[sub_resource type="QuadMesh" id="QuadMesh_fokd8"]
flip_faces = true
size = Vector2(2, 2)

[sub_resource type="Image" id="Image_p530x"]
data = {
"data": PackedByteArray("Wli7Po4tQz6VbT8/AACAPwPhuD6pVB89VJRhPwAAgD8qERY/dB8DP2rwQz8AAIA/7LRXP0M9UT8j1Dg/AACAP77l+j4fw2o+eJO4PgAAgD8UJa08u6QMP/CjjT0AAIA/ElolPsImDT1ATg0/AACAPw1N9D6Helc/2iz6PgAAgD+jx8g+Eb/EPsLQlz0AAIA/WSV5P9TfUz/h/wI/AACAPyxl2z2sZCA/mlzIPgAAgD80gzc/uDzhPvyvVz8AAIA/N0cSP6TyIj+wpp08AACAP3B77D5HSus+CG+XPgAAgD8c4Ss/iw9FPizNXD8AAIA/y66dPtx2FT/pzGc8AACAPwHg2T6Z19A8TcvRPgAAgD8EM8I+B+BAP/Q1CD4AAIA/tAkdPxIPiD7R7Es/AACAP39dQj/V+BA/YV+VPgAAgD/NN1U+OKqHPsziHj4AAIA/YHgUP7XTuT5O6Ug/AACAP5xtBz+5NxY/kT/nPgAAgD8JTb0+bgkkP26fEj4AAIA/5b5JP9gujz6OLrI8AACAPw=="),
"format": "RGBAFloat",
"height": 5,
"mipmaps": false,
"width": 5
}

[sub_resource type="Image" id="Image_j5w1c"]
data = {
"data": PackedByteArray("yRRCP22c4j5AV38+AACAP+1/Zj+j5TI/yDA4PwAAgD89iQU/QoTaPtwJATwAAIA/fO0LP35YkD71ScI+AACAP+vPFz/3acw+AmtRPwAAgD+OFT4/6ZlZP5nY7T4AAIA/xKssPy/Raz8SsNY9AACAP9sNFj1SGl8/Ahb3PgAAgD99M6g+z6p0PybC+z4AAIA/3A42PlFaRj9+lGg+AACAP9gRoT6bJ0o/J1BfPwAAgD9gkBk+EzlnP3smPD8AAIA/0Ce1Pu2lTj+Pnqs+AACAP3bjST9VvMI+yicCPwAAgD8wsxU/v3cxPoeUPj4AAIA/Ht9QPy9IDT4dmNU9AACAP89WTj9gPlk9qM9mPwAAgD9ufnA9Xd4MP73GxD4AAIA/A6DwPDPQNT1AHA4/AACAPx8UZT+1zGg/Ms2xPgAAgD9LbiQ+Q2UUPtu+Fz8AAIA/tTlPPspZIz+YYoI+AACAP5PDOj9w6X4/LpQpPwAAgD9ZeQw/QUrJPul/kD4AAIA/PgkcPRW5Gz5OPC4/AACAPw=="),
"format": "RGBAFloat",
"height": 5,
"mipmaps": false,
"width": 5
}

[sub_resource type="Image" id="Image_jn74y"]
data = {
"data": PackedByteArray("EV4aP+ZVoT5sngc/AACAP8pyKz+Szwg/ILQwPQAAgD+MoXw/Mq41P2lzMT8AAIA/UbX1PpQYEz+qRaY9AACAP0XPPj/Iyhs/0lwQPgAAgD82VQM/XR1uP19YWj8AAIA/ExsoP+vUTz/XU2o/AACAP/iq4D70XBU+f/w+PgAAgD/ADU8+cqYKP1oxPD8AAIA/o/BWPsbRfj5vHvs+AACAPx1tAD64+GU/KuoJPQAAgD8yRzw+uREcP38MBT8AAIA/NNkhPnX6rz7ivH4/AACAPx/V8D6hC9M9IjOUPgAAgD8uwCE/5WzsPsp6Qz8AAIA/t61PP2d1Xz7FBDo/AACAP+f6aj/aKAg/x9BAOwAAgD/Yo6Q+ewxMP0KTFz8AAIA/Vb8QP2+Uoj1Bm3o/AACAP5nfbD++UlQ/j0qIPgAAgD/5Ug8+uAQXPh+5Oz8AAIA/9rhYP3/pVz83smY/AACAPwQBAzxkXxo/nSZBPwAAgD94NXU/KfxpP44iTT8AAIA/gvmKPtoHzj699SA/AACAPw=="),
"format": "RGBAFloat",
"height": 5,
"mipmaps": false,
"width": 5
}

[sub_resource type="Image" id="Image_dgbtu"]
data = {
"data": PackedByteArray("3l4YPkqRwD6Qkws+AACAP+7MZz++IUM/hzLEPgAAgD9BPWI+fRwOPqXSWT8AAIA/+NRoPwd0aT/sHOs+AACAP0gFHD/Ye4s+BaaUPgAAgD/RHCc/O+2lPsugRjwAAIA/2ZxQP4hzej/wnrA9AACAP/ikhz4y/mA/We8APwAAgD9COkk+6WFOPu+H5D4AAIA/VsJ9P0D1Bz53nwU/AACAP4tFEj5G/mc/h6arPgAAgD/X4m0/gHAzPxKACD8AAIA/K/d8P15LBD81HTc/AACAP7T3Zz+Ei2U/Oh1QPwAAgD/0KFU/gWX2PoZl5T4AAIA/+HkIP88BOz+wg3A/AACAP07MZz5RZO0+FXIcPwAAgD8i2xk/JNW/PtgmUD8AAIA/jyvbPdiJBD9NJRE/AACAP1eG0T33iX8/h3wXPwAAgD/NtI4+zpZ2P6sfdj8AAIA/VqcwPnFDDT6htwc/AACAP5hp6z0+NSw/LVKJPgAAgD9Y0WY/VdF+P8zIJj8AAIA/JA1eP0vTiT5gNFM+AACAPw=="),
"format": "RGBAFloat",
"height": 5,
"mipmaps": false,
"width": 5
}

[sub_resource type="Image" id="Image_u1mxf"]
data = {
"data": PackedByteArray("xTCwPAUIDz88//U+AACAP2+Kuz16IZM+de8XPgAAgD/oLs097W+rO54h/j4AAIA/V4nXPg53BD/3Wkc/AACAPyiiZz9Iz20/3+waPwAAgD+VTDM/qC5sP9uhmT0AAIA/Maw9P4IBHj/hRmM/AACAP+NclT3xEvo+p6U+PwAAgD+SvVk/qdcSP5bwRz8AAIA/yqQLPwb+2TuLVC4/AACAPwyczTwjEbQ+CzyEPgAAgD8pTEM/ca2kPgY0GT8AAIA/dh1WP3+qRz8VyBs/AACAP2qkHT5e1us+EtVEPwAAgD8U8Sg/3xYCPyuLQjsAAIA/ZW6nPpqNJD7e7Wk/AACAP5Fucj8vGBw9C4TvPgAAgD9aNIw+2fUBP3DjKD8AAIA/mNM7PmfXdT8txAQ/AACAPxdTBz9qsN0+vTImPgAAgD9VbUQ/n+tHO4PU+j4AAIA/E3DnPllZJz96l9Q+AACAP5I0Vj6mK2Q+4FyzPgAAgD8tSvI+c28PP40SDD8AAIA/noBjP3ADOj+jyks/AACAPw=="),
"format": "RGBAFloat",
"height": 5,
"mipmaps": false,
"width": 5
}

[sub_resource type="ImageTexture3D" id="ImageTexture3D_b4lto"]
_images = Array[Image]([SubResource("Image_p530x"), SubResource("Image_j5w1c"), SubResource("Image_jn74y"), SubResource("Image_dgbtu"), SubResource("Image_u1mxf")])

[sub_resource type="BoxMesh" id="BoxMesh_tlufb"]

[sub_resource type="Shader" id="Shader_7m0u7"]
code = "shader_type spatial;
render_mode unshaded, fog_disabled;
uniform sampler3D sampler;
uniform float scale;
void fragment() {
vec3 worldPosition = ((INV_VIEW_MATRIX * vec4(VERTEX,1)).xyz);
	worldPosition*=scale;
	ALBEDO = texture(sampler,worldPosition ).xyz;


}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0p8pk"]
render_priority = 0
shader = SubResource("Shader_7m0u7")
shader_parameter/sampler = ExtResource("9_g02a5")
shader_parameter/scale = 0.04

[sub_resource type="FastNoiseLite" id="FastNoiseLite_m7fkw"]
frequency = 0.0108

[sub_resource type="NoiseTexture3D" id="NoiseTexture3D_rjt2i"]
width = 320
height = 80
depth = 320
seamless = true
seamless_blend_skirt = 0.272
noise = SubResource("FastNoiseLite_m7fkw")

[sub_resource type="Resource" id="Resource_4l6qq"]
script = ExtResource("10_g02a5")
texture = SubResource("NoiseTexture3D_rjt2i")
influence = 1.0
metadata/_custom_type_script = "uid://h50akikpf6si"

[sub_resource type="Resource" id="Resource_15nl4"]
script = ExtResource("10_g02a5")
texture = ExtResource("9_p530x")
influence = 1.0
metadata/_custom_type_script = "uid://h50akikpf6si"

[node name="scene" type="Node3D"]

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.873772, 0.486335, 0, -0.486335, 0.873772, 0, 2.45046, 0)

[node name="Target" type="Node3D" parent="."]
transform = Transform3D(480, 0, 0, 0, 170.31, 0, 0, 0, 480, -32.8607, 0, -472.342)
script = ExtResource("1_nxogm")
boxMin = Vector3(-272.861, -85.155, -712.342)
boxMax = Vector3(207.139, 85.155, -232.342)
DrawDebug = true

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 11.7036)
script = ExtResource("2_m7jmp")

[node name="ray tracing handler" type="Node3D" parent="Camera3D" node_paths=PackedStringArray("cam", "rayTarget", "light")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 45.4541)
script = ExtResource("2_3253y")
cam = NodePath("..")
output = ExtResource("4_tqduk")
shaderFile = ExtResource("3_u3cyc")
rayTarget = NodePath("../../Target")
light = NodePath("../../DirectionalLight3D")
noiseTexture = ExtResource("6_g02a5")
rayMarchStepSize = 0.1
alphaModifier = 0.03
detailNoiseModifier = -0.015
alphaTotalModifier = 22.77
lightAbsorptionThroughCloud = 1.19
lightMarchStepsCount = 2
darknessThreshold = 0.1
lightAbsorptionTowardSun = 0.065
colorNoiseAlphaModifier = 0.1
colorNoiseScale = 2.795
brightnessModifier = 1.245
lightColor = Color(1, 1, 1, 0)
cloudColor = Color(1, 1, 1, 0)
chunkSize = Vector3(2773.72, 600, 3524.57)
cloudsOffset = Vector3(100, 0, 0)
windSpeed = Vector3(10, 5, 2)

[node name="output" type="MeshInstance3D" parent="Camera3D"]
extra_cull_margin = 16384.0
mesh = SubResource("QuadMesh_fokd8")
surface_material_override/0 = ExtResource("4_tqduk")

[node name="VornoiNoise" type="Node3D" parent="."]
script = ExtResource("7_tqduk")
CellSize = 16
ResolutionInCells = Vector3i(5, 5, 5)
seed = -864
shaderFile = ExtResource("8_0sf6n")
output = ExtResource("9_g02a5")
outputResolution = Vector3i(80, 80, 80)
distanceModifier = 0.115
invert = true
randomPointsDebug = Array[Vector3]([Vector3(0.365908, 0.190603, 0.747766), Vector3(0.75813, 0.4426, 0.249356), Vector3(0.602998, 0.315108, 0.529761), Vector3(0.148799, 0.376108, 0.136305), Vector3(0.0215076, 0.558716, 0.480463), Vector3(0.0211358, 0.549389, 0.0691603), Vector3(0.742516, 0.850005, 0.464543), Vector3(0.513019, 0.930136, 0.852911), Vector3(0.652783, 0.324076, 0.0121233), Vector3(0.700387, 0.922587, 0.0750157), Vector3(0.107127, 0.626536, 0.391331), Vector3(0.314589, 0.789667, 0.872317), Vector3(0.125416, 0.898326, 0.0336706), Vector3(0.142843, 0.906224, 0.335255), Vector3(0.0250988, 0.351693, 0.258271), Vector3(0.307974, 0.583845, 0.014148), Vector3(0.815904, 0.137971, 0.104294), Vector3(0.811244, 0.218221, 0.726635), Vector3(0.533111, 0.730496, 0.939509), Vector3(0.327014, 0.160696, 0.913786), Vector3(0.208221, 0.264971, 0.155162), Vector3(0.160577, 0.144918, 0.592756), Vector3(0.139965, 0.147479, 0.733293), Vector3(0.278723, 0.963239, 0.961421), Vector3(0.767293, 0.00305054, 0.489903), Vector3(0.361092, 0.0388991, 0.88117), Vector3(0.900389, 0.698816, 0.719494), Vector3(0.66972, 0.534417, 0.0431405), Vector3(0.905471, 0.762234, 0.383198), Vector3(0.0915726, 0.287365, 0.148374), Vector3(0.161476, 0.0344608, 0.551975), Vector3(0.674496, 0.921161, 0.104828), Vector3(0.656663, 0.811843, 0.915342), Vector3(0.814893, 0.978325, 0.0862406), Vector3(0.740909, 0.617211, 0.8878), Vector3(0.716846, 0.439916, 0.842529), Vector3(0.149965, 0.903215, 0.734962), Vector3(0.183865, 0.609645, 0.519722), Vector3(0.929243, 0.700935, 0.533204), Vector3(0.762881, 0.321636, 0.59845), Vector3(0.425537, 0.0254934, 0.409754), Vector3(0.806012, 0.053038, 0.901606), Vector3(0.917891, 0.531873, 0.00294213), Vector3(0.226365, 0.463656, 0.611116), Vector3(0.947, 0.038109, 0.467804), Vector3(0.579962, 0.362943, 0.78481), Vector3(0.202369, 0.638089, 0.254658), Vector3(0.846572, 0.843407, 0.901157), Vector3(0.172513, 0.137953, 0.530146), Vector3(0.452027, 0.653707, 0.415218), Vector3(0.586199, 0.512199, 0.765387), Vector3(0.521625, 0.42679, 0.00787589), Vector3(0.98684, 0.709689, 0.693167), Vector3(0.220937, 0.138781, 0.85087), Vector3(0.100187, 0.00523185, 0.49635), Vector3(0.47715, 0.841713, 0.488623), Vector3(0.0366343, 0.871495, 0.48259), Vector3(0.438804, 0.145862, 0.18651), Vector3(0.26493, 0.878879, 0.503652), Vector3(0.0729311, 0.488426, 0.744715), Vector3(0.571399, 0.636515, 0.0192445), Vector3(0.353819, 0.807219, 0.335194), Vector3(0.158055, 0.343708, 0.99507), Vector3(0.988146, 0.516775, 0.715289), Vector3(0.836387, 0.779945, 0.608522), Vector3(0.379295, 0.753418, 0.133018), Vector3(0.0587143, 0.550268, 0.384329), Vector3(0.321563, 0.797065, 0.592091), Vector3(0.601, 0.374673, 0.813093), Vector3(0.273837, 0.507658, 0.65972), Vector3(0.529016, 0.586788, 0.451657), Vector3(0.729547, 0.995749, 0.662417), Vector3(0.00799585, 0.603018, 0.754495), Vector3(0.114947, 0.672687, 0.268205), Vector3(0.209185, 0.222823, 0.350318), Vector3(0.842604, 0.817341, 0.721987), Vector3(0.546592, 0.281925, 0.37947), Vector3(0.479899, 0.574594, 0.0811876), Vector3(0.9095, 0.911927, 0.459205), Vector3(0.42097, 0.517442, 0.778732), Vector3(0.392148, 0.38427, 0.0741286), Vector3(0.328518, 0.955731, 0.491716), Vector3(0.202201, 0.541602, 0.735128), Vector3(0.196511, 0.201545, 0.44635), Vector3(0.850549, 0.573603, 0.781015), Vector3(0.461879, 0.459551, 0.295769), Vector3(0.788627, 0.380343, 0.50842), Vector3(0.470376, 0.10305, 0.289453), Vector3(0.906123, 0.89666, 0.812946), Vector3(0.153948, 0.46062, 0.768876), Vector3(0.613429, 0.26574, 0.796582), Vector3(0.0293732, 0.044388, 0.555119), Vector3(0.565419, 0.0793847, 0.978931), Vector3(0.107017, 0.517728, 0.566975), Vector3(0.183424, 0.960318, 0.518618), Vector3(0.369728, 0.640769, 0.143186), Vector3(0.548727, 0.393145, 0.282226), Vector3(0.957847, 0.914004, 0.801309), Vector3(0.901632, 0.995382, 0.651501), Vector3(0.473222, 0.560294, 0.547158), Vector3(0.490034, 0.22926, 0.3605), Vector3(0.593016, 0.399246, 0.818039), Vector3(0.74535, 0.608563, 0.140979), Vector3(0.609456, 0.272429, 0.290329), Vector3(0.904818, 0.928944, 0.605177), Vector3(0.973226, 0.827634, 0.511717), Vector3(0.177791, 0.774816, 0.227129), Vector3(0.209902, 0.248847, 0.490467), Vector3(0.991247, 0.132771, 0.521964), Vector3(0.545483, 0.0066526, 0.680978), Vector3(0.671404, 0.192442, 0.862506), Vector3(0.584765, 0.173308, 0.186113), Vector3(0.631839, 0.461768, 0.763592), Vector3(0.832656, 0.481243, 0.44804), Vector3(0.659929, 0.508161, 0.0029685), Vector3(0.759239, 0.566297, 0.291743), Vector3(0.894838, 0.909374, 0.347269), Vector3(0.925287, 0.829388, 0.266194), Vector3(0.102307, 0.998199, 0.591744), Vector3(0.528612, 0.432987, 0.162303), Vector3(0.788069, 0.279654, 0.0217507), Vector3(0.0380948, 0.152073, 0.680608), Vector3(0.271435, 0.402404, 0.62875), Vector3(0.867388, 0.26919, 0.206254), Vector3(0.888681, 0.726615, 0.796061)])
randomPointsTexture = SubResource("ImageTexture3D_b4lto")

[node name="noise tester" type="MeshInstance3D" parent="."]
transform = Transform3D(480, 0, 0, 0, 170.31, 0, 0, 0, 480, 1311.45, 948.4, -5590.1)
mesh = SubResource("BoxMesh_tlufb")
skeleton = NodePath("../Target")
surface_material_override/0 = SubResource("ShaderMaterial_0p8pk")

[node name="Texture composer" type="Node" parent="."]
script = ExtResource("10_0gbod")
red = [SubResource("Resource_4l6qq")]
useGreen = true
green = [SubResource("Resource_15nl4")]
format = 9
maxBrightness = 1.0
output = ExtResource("6_g02a5")
